\chapter{Implementierung des Chat-Screens}
Zu jeder modernen Community Applikation gehört auch die Chatfunktionalität immer dazu. Der Austausch zwischen zwei oder mehreren Menschen ist besonders in der STH App wichtig, um die Kommunikation zwischen Spielern und Managern zu ermöglichen. Die Anforderungen an den Chat-Screen standen schnell fest. Die Funktionalität muss mindestens den gleichen Interaktionsumfang ermöglichen, wie vergleichbare Apps wie z.B. Instagram, Snapchat oder X (ehemalig Twitter).

\section{Anforderungen an den Chat-Screen}
Die spezifischen Anforderungen für die Chat-Funktion in der STH App wurden im Projektteam gemeinsam ausgearbeitet. Dabei wurden zunächst vergleichbare Applikationen genauer beleuchtet und die Mindestanforderungen anhand der dort gesichteten Funktionen definiert. Das Chatten in der STH App muss mittels verschlüsselte eins zu eins Verbindungen funktionieren, in der zwei Menschen miteinander in einem Chat-Raum kommunizieren können. Zudem muss es auch die Möglichkeit geben Gruppenchats zu erstellen und mehrere Menschen dazu einzuladen. Auch hierbei müssen die Verbindungen stets verschlüsselt sein. Innerhalb eines Chats muss jeder Nutzer Nachrichten senden und empfangen können. Zu den Nachrichten gehören Textnachrichten, GIFs, Bilder und Videos. Jeder Nutzer muss gesendete und empfangene Nachrichten im Chat sehen können und die Chats müssen mit ihrem kompletten Verlauf beim ein- und ausloggen erhalten und neu geladen werden können.

\section{Erstellung einer Flutter Widget-Seite}
Nachdem die Anforderungen definiert wurden, kann nun die Erstellung der Chat-Screen Widget-Seite beginnen. Diese Seiten dienen also Vorbereitung dazu Widgets platzieren und anzeigen zu können. Das Erstellen einer derartigen Seite kann in Flutter durch das Erstellen einer Klasse realisiert werden. Hierbei wird für die Klasse ein kontextbezogener Name eingesetzt und die Art der Widget-Seite definiert werden. Dabei wird zwischen Stateful und Stateless Widgets unterschieden. Bei den Stateful Widget Klassen deren Komponenten sich verändern können. Die Stateless Widgets verändern sich nicht und können sich nicht in der Ansicht aktualisieren. Für den Chat-Screen ist das Stateful Klassenwidget die richtige Wahl, da sich die Anzahl und Inhalte der angezeigten Chats stetig verändern kann.

\section{Integration des stream-chat-flutter Pakets}
Die Implementierung einer Chat-Funktion kommt in Social-Media Apps sehr häufig bzw. fast immer vor. Deshalb gibt es hierzu eine große Anzahl an Flutter Paketen, welche sich unter der Seite pub.dev genauer angeschaut werden können. Ein sehr mächtiges und umfängliches Paket nennt sich hierbei stream-chat-flutter. Dieses Paket bringt eine Anzahl an vorbereiteten Widgets für die Anzeige und Erstellung von Chats mit sich. Darin beinhaltet sind App-Bars, Channelscreens, Chat-Screens und Chatfunktionen. Die Einbindung dieses Pakets erfordert das verändern der gesamten Struktur der Anwendung. Die Chat-Funktion stellt einen Hauptbestandteil der Anwendung dar und muss auf den sogeannten top of widget tree implementiert werden. Das bedeutet, dass das Paket stream-chat-flutter als erstes in der Anwendung geladen werden muss, um es korrekt auszuführen. Nachdem die Struktur und das laden der Pakete in der Anwendung angepasst wird, müssen Funktionen geschrieben werden, die das Abrufen von Chats aus dem stream-chat-client ermöglichen. Dabei greift die STH App auf das seperate Backend des Paketes zu und authentifiziert den aktuellen Nutzer der Applikation. Nach erfolgreicher Authentifizierung werden die zugehörigen Chatdaten und Channels abgerufen, um den Nutzer alle Chatverläufe korrekt anzeigen zu können.

\section{Benutzerauthentifizierung}
Um die Benutzerauthentifizierung durch die Anwendung zu ermgöglichen, müssen Zugangschlüssel bzw. Tokens bereitstehen. Diese tokens werden durch den Aufruf durch Firebase generiert und der jeweilige Nutzer der Anwendung registriert. Nach erfolgreicher Übermittlung der Tokens, kann die STH App nun sicherstellen, dass es sich um den angemeldeteten Nutzer handelt und alle Chatverläufe inklusive persönlicher Daten laden. 

\section{Implementierung der Chat-Widgets}
Nach der erfolgreichen Benutzerauthentifizierung folgt der letzte Schritt. Die verschiedenen Chats des Nutzers und die Chatverläufe können mittels der Chat-Widgets aus dem Paket stream-chat-flutter angezeigt werden. Das Paket beinhaltet einen Channelscreen. Das ist das Widget, welches zuerst beim Einstieg in die Chatfuntktionene angezeigt wird. Analog zu anderen bekannten Applikation wird hierbei eine Übersicht über alle aktiven Chats des Nutzers angezeigt. Daraufhin folgt der Chatsreen. Dieser stellt den einzelnen Chat, auf dem vom Channelscreen aus geklickt wird, dar. Im Chatscreen ist der gesamte Chatverlauf aus diesem Chat des Nutzers zu sehen. Zudem kann hier durch das Textfeld am unteren Ende der Seite neue Nachrichten durch den Nutzer eingegeben werden und an den Chatpartner versendet werden.

\noindent
Die Implementierung des Channelscreens erfolgt als erstes. Hierfür wird eine eigene Klasse erstellt und das Chatscreen Widget aus dem Paket wird auf dieser Seite platziert. Nun muss noch das richtige Routing definiert werden. Das stellt sicher, dass die verschiedenen Chats geladen werden können. Die Liste der verfügbaren Chats wird geladen und am oberen Ende der Seite wird die App-Bar mit dem Namen Chats angezeigt.

\noindent
Nach der Integration des Channelscreen Widgets kann nun das Chatscreen Widget folgen. Für das Chatscreen Widget wird ebenso eine neue klasse und Seite erstellt, worauf das Widget platziert werden kann. Nach der Platzierung wird durch das korrekte Routing sichergestellt, dass der richtige Chat vom angemeldeten User geöffnet wird. Durch die nahtlose Integration des Paketes sind alle Funktionen automatisch verfügbar. Das versenden und empfangen von Nachrichten ist bereits möglich und das reagieren auf Nachrichten ebenso. Zu normalen Textnachrichten können auch Bilder, Gifs und Emojis versendet werden. Die Grundfunktionalitäten einer ausgereiten Social-Media App stehen nun mit der Chatfunktion.